{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Страница согласования и рассылки</title>
    <link rel="stylesheet" href="{% static 'inspector/css/style.css' %}">
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      h1 { color: #0d6efd; }
      .week-nav { display: flex; justify-content: space-between; margin: 15px 0; }
      .week-group { margin-bottom: 30px; border: 1px solid #ddd; border-radius: 8px; padding: 10px; }
      .violations-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
      .violations-table th, .violations-table td {
        border: 1px solid #ccc; padding: 6px 8px; text-align: left;
      }
      .violations-table th { background: #f5f5f5; }
      .btn { padding: 8px 14px; border: none; border-radius: 5px; cursor: pointer; }
      .btn-approve { background: #198754; color: white; }
      .btn-week { background: #0d6efd; color: white; }
    </style>
</head>
<body>
    <h1>Страница согласования и рассылки</h1>

    <!-- Навигация по неделям -->
    <div class="week-nav">
        <button class="btn btn-week" id="prev-week">← Предыдущая неделя</button>
        <span id="current-week-label">Неделя {{ current_week }}</span>
        <button class="btn btn-week" id="next-week">Следующая неделя →</button>
    </div>

    {% for week, violation_list in violations_by_week.items %}
      <div class="week-group" data-week="{{ week }}">
        <h2>Неделя {{ week }}</h2>
        <label>
          <input type="checkbox" class="select-week" data-week="{{ week }}"> Выбрать все за неделю
        </label>
        <table class="violations-table">
          <thead>
            <tr>
              <th>✓</th>
              <th>ID</th>
              <th>Дата</th>
              <th>Аэропорт</th>
              <th>Рейс</th>
              <th>Направление</th>
              <th>Служба</th>
              <th>Вид нарушения</th>
              <th>Описание</th>
              <th>Кем выявлено</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody>
            {% for viol in violation_list %}
            <tr>
              <td><input type="checkbox" name="violation" value="{{ viol.id }}" data-week="{{ week }}" class="violation-checkbox"></td>
              <td>{{ viol.id }}</td>
              <td>{{ viol.date|date:"Y-m-d" }}</td>
              <td>{{ viol.airport }}</td>
              <td>{{ viol.flight }}</td>
              <td>{{ viol.direction }}</td>
              <td>{{ viol.service }}</td>
              <td>{{ viol.violation }}</td>
              <td>{{ viol.description }}</td>
              <td>{{ viol.inspector }}</td>
              <td>{{ viol.status }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% empty %}
      <p><em>Нет нарушений со статусом "approved".</em></p>
    {% endfor %}

    <!-- Кнопка для отправки -->
    <button class="btn btn-approve" id="send-for-approval-btn">Отправить на согласование</button>

    <input type="hidden" name="csrf-token" value="{{ csrf_token }}">
    <script src="{% static 'inspector/js/violations_by_week.js' %}"></script>
</body>
</html>
